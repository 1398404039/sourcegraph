/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';
var ExtHostProgress = (function () {
    function ExtHostProgress(proxy) {
        this._handles = 0;
        this._proxy = proxy;
    }
    ExtHostProgress.prototype.withWindowProgress = function (extension, title, task) {
        var handle = this._handles++;
        this._proxy.$startWindow(handle, title);
        return this._withProgress(handle, task);
    };
    ExtHostProgress.prototype.withScmProgress = function (extension, task) {
        var handle = this._handles++;
        this._proxy.$startScm(handle);
        return this._withProgress(handle, task);
    };
    ExtHostProgress.prototype._withProgress = function (handle, task) {
        var _this = this;
        var progress = {
            report: function (message) {
                _this._proxy.$progressReport(handle, message);
            }
        };
        var p;
        try {
            p = task(progress, null);
        }
        catch (err) {
            this._proxy.$progressEnd(handle);
            throw err;
        }
        return p.then(function (result) {
            _this._proxy.$progressEnd(handle);
            return result;
        }, function (err) {
            _this._proxy.$progressEnd(handle);
            throw err;
        });
    };
    return ExtHostProgress;
}());
exports.ExtHostProgress = ExtHostProgress;
