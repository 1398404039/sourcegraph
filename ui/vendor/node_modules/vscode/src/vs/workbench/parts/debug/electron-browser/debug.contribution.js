/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
require("../browser/media/debug.contribution.css");
require("../browser/media/debugHover.css");
var nls = require("vs/nls");
var actions_1 = require("vs/platform/actions/common/actions");
var platform = require("vs/platform/platform");
var extensions_1 = require("vs/platform/instantiation/common/extensions");
var keybindingsRegistry_1 = require("vs/platform/keybinding/common/keybindingsRegistry");
var descriptors_1 = require("vs/platform/instantiation/common/descriptors");
var confregistry = require("vs/platform/configuration/common/configurationRegistry");
var wbaregistry = require("vs/workbench/common/actionRegistry");
var viewlet = require("vs/workbench/browser/viewlet");
var panel = require("vs/workbench/browser/panel");
var debugViewRegistry_1 = require("vs/workbench/parts/debug/browser/debugViewRegistry");
var debugViews_1 = require("vs/workbench/parts/debug/electron-browser/debugViews");
var wbext = require("vs/workbench/common/contributions");
var baseEditor_1 = require("vs/workbench/browser/parts/editor/baseEditor");
var debug = require("vs/workbench/parts/debug/common/debug");
var partService_1 = require("vs/workbench/services/part/common/partService");
var panelService_1 = require("vs/workbench/services/panel/common/panelService");
var debugEditorModelManager_1 = require("vs/workbench/parts/debug/browser/debugEditorModelManager");
var debugActions_1 = require("vs/workbench/parts/debug/browser/debugActions");
var debugwidget = require("vs/workbench/parts/debug/browser/debugActionsWidget");
var service = require("vs/workbench/parts/debug/electron-browser/debugService");
var debugEditorInputs_1 = require("vs/workbench/parts/debug/browser/debugEditorInputs");
var debugErrorEditor_1 = require("vs/workbench/parts/debug/browser/debugErrorEditor");
require("vs/workbench/parts/debug/electron-browser/debugEditorContribution");
var viewlet_1 = require("vs/workbench/services/viewlet/browser/viewlet");
var editor_1 = require("vs/workbench/common/editor");
var editorService_1 = require("vs/workbench/services/editor/common/editorService");
var IDebugService = debug.IDebugService;
var OpenDebugViewletAction = (function (_super) {
    __extends(OpenDebugViewletAction, _super);
    function OpenDebugViewletAction(id, label, viewletService, editorService) {
        return _super.call(this, id, label, debug.VIEWLET_ID, viewletService, editorService) || this;
    }
    return OpenDebugViewletAction;
}(viewlet.ToggleViewletAction));
OpenDebugViewletAction.ID = debug.VIEWLET_ID;
OpenDebugViewletAction.LABEL = nls.localize('toggleDebugViewlet', "Show Debug");
OpenDebugViewletAction = __decorate([
    __param(2, viewlet_1.IViewletService),
    __param(3, editorService_1.IWorkbenchEditorService)
], OpenDebugViewletAction);
var OpenDebugPanelAction = (function (_super) {
    __extends(OpenDebugPanelAction, _super);
    function OpenDebugPanelAction(id, label, panelService, partService) {
        return _super.call(this, id, label, debug.REPL_ID, panelService, partService) || this;
    }
    return OpenDebugPanelAction;
}(panel.TogglePanelAction));
OpenDebugPanelAction.ID = 'workbench.debug.action.toggleRepl';
OpenDebugPanelAction.LABEL = nls.localize('toggleDebugPanel', "Debug Console");
OpenDebugPanelAction = __decorate([
    __param(2, panelService_1.IPanelService),
    __param(3, partService_1.IPartService)
], OpenDebugPanelAction);
// register viewlet
platform.Registry.as(viewlet.Extensions.Viewlets).registerViewlet(new viewlet.ViewletDescriptor('vs/workbench/parts/debug/browser/debugViewlet', 'DebugViewlet', debug.VIEWLET_ID, nls.localize('debug', "Debug"), 'debug', 40));
var openViewletKb = {
    primary: 32768 /* CtrlCmd */ | 16384 /* Shift */ | 34 /* KEY_D */
};
var openPanelKb = {
    primary: 32768 /* CtrlCmd */ | 16384 /* Shift */ | 55 /* KEY_Y */
};
// register repl panel
platform.Registry.as(panel.Extensions.Panels).registerPanel(new panel.PanelDescriptor('vs/workbench/parts/debug/electron-browser/repl', 'Repl', debug.REPL_ID, nls.localize({ comment: ['Debug is a noun in this context, not a verb.'], key: 'debugPanel' }, 'Debug Console'), 'repl', 30));
platform.Registry.as(panel.Extensions.Panels).setDefaultPanelId(debug.REPL_ID);
// Register default debug views
debugViewRegistry_1.DebugViewRegistry.registerDebugView(debugViews_1.VariablesView, 10);
debugViewRegistry_1.DebugViewRegistry.registerDebugView(debugViews_1.WatchExpressionsView, 20);
debugViewRegistry_1.DebugViewRegistry.registerDebugView(debugViews_1.CallStackView, 30);
debugViewRegistry_1.DebugViewRegistry.registerDebugView(debugViews_1.BreakpointsView, 40);
// register action to open viewlet
var registry = platform.Registry.as(wbaregistry.Extensions.WorkbenchActions);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(OpenDebugPanelAction, OpenDebugPanelAction.ID, OpenDebugPanelAction.LABEL, openPanelKb), 'View: Debug Console', nls.localize('view', "View"));
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(OpenDebugViewletAction, OpenDebugViewletAction.ID, OpenDebugViewletAction.LABEL, openViewletKb), 'View: Show Debug', nls.localize('view', "View"));
platform.Registry.as(wbext.Extensions.Workbench).registerWorkbenchContribution(debugEditorModelManager_1.DebugEditorModelManager);
platform.Registry.as(wbext.Extensions.Workbench).registerWorkbenchContribution(debugwidget.DebugActionsWidget);
var debugCategory = nls.localize('debugCategory', "Debug");
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.StartAction, debugActions_1.StartAction.ID, debugActions_1.StartAction.LABEL, { primary: 63 /* F5 */ }, debug.CONTEXT_NOT_IN_DEBUG_MODE), 'Debug: Start Debugging', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.StepOverAction, debugActions_1.StepOverAction.ID, debugActions_1.StepOverAction.LABEL, { primary: 68 /* F10 */ }, debug.CONTEXT_IN_DEBUG_MODE), 'Debug: Step Over', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.StepIntoAction, debugActions_1.StepIntoAction.ID, debugActions_1.StepIntoAction.LABEL, { primary: 69 /* F11 */ }, debug.CONTEXT_IN_DEBUG_MODE, keybindingsRegistry_1.KeybindingsRegistry.WEIGHT.workbenchContrib(1)), 'Debug: Step Into', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.StepOutAction, debugActions_1.StepOutAction.ID, debugActions_1.StepOutAction.LABEL, { primary: 16384 /* Shift */ | 69 /* F11 */ }, debug.CONTEXT_IN_DEBUG_MODE), 'Debug: Step Out', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.RestartAction, debugActions_1.RestartAction.ID, debugActions_1.RestartAction.LABEL, { primary: 16384 /* Shift */ | 32768 /* CtrlCmd */ | 63 /* F5 */ }, debug.CONTEXT_IN_DEBUG_MODE), 'Debug: Restart', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.StopAction, debugActions_1.StopAction.ID, debugActions_1.StopAction.LABEL, { primary: 16384 /* Shift */ | 63 /* F5 */ }, debug.CONTEXT_IN_DEBUG_MODE), 'Debug: Stop', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.DisconnectAction, debugActions_1.DisconnectAction.ID, debugActions_1.DisconnectAction.LABEL), 'Debug: Disconnect', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.ContinueAction, debugActions_1.ContinueAction.ID, debugActions_1.ContinueAction.LABEL, { primary: 63 /* F5 */ }, debug.CONTEXT_IN_DEBUG_MODE), 'Debug: Continue', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.PauseAction, debugActions_1.PauseAction.ID, debugActions_1.PauseAction.LABEL), 'Debug: Pause', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.ConfigureAction, debugActions_1.ConfigureAction.ID, debugActions_1.ConfigureAction.LABEL), 'Debug: Open launch.json', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.AddFunctionBreakpointAction, debugActions_1.AddFunctionBreakpointAction.ID, debugActions_1.AddFunctionBreakpointAction.LABEL), 'Debug: Add Function Breakpoint', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.ReapplyBreakpointsAction, debugActions_1.ReapplyBreakpointsAction.ID, debugActions_1.ReapplyBreakpointsAction.LABEL), 'Debug: Reapply All Breakpoints', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.RunAction, debugActions_1.RunAction.ID, debugActions_1.RunAction.LABEL, { primary: 32768 /* CtrlCmd */ | 63 /* F5 */ }, debug.CONTEXT_NOT_IN_DEBUG_MODE), 'Debug: Start Without Debugging', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.RemoveAllBreakpointsAction, debugActions_1.RemoveAllBreakpointsAction.ID, debugActions_1.RemoveAllBreakpointsAction.LABEL), 'Debug: Remove All Breakpoints', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.EnableAllBreakpointsAction, debugActions_1.EnableAllBreakpointsAction.ID, debugActions_1.EnableAllBreakpointsAction.LABEL), 'Debug: Enable All Breakpoints', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.DisableAllBreakpointsAction, debugActions_1.DisableAllBreakpointsAction.ID, debugActions_1.DisableAllBreakpointsAction.LABEL), 'Debug: Disable All Breakpoints', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.ClearReplAction, debugActions_1.ClearReplAction.ID, debugActions_1.ClearReplAction.LABEL), 'Debug: Clear Debug Console', debugCategory);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(debugActions_1.FocusReplAction, debugActions_1.FocusReplAction.ID, debugActions_1.FocusReplAction.LABEL), 'Debug: Focus Debug Console', debugCategory);
keybindingsRegistry_1.KeybindingsRegistry.registerCommandAndKeybindingRule({
    id: '_workbench.startDebug',
    weight: keybindingsRegistry_1.KeybindingsRegistry.WEIGHT.workbenchContrib(0),
    handler: function (accessor, configurationOrName) {
        var debugService = accessor.get(debug.IDebugService);
        return debugService.createProcess(configurationOrName);
    },
    when: debug.CONTEXT_NOT_IN_DEBUG_MODE,
    primary: undefined
});
// register service
extensions_1.registerSingleton(IDebugService, service.DebugService);
// Register Debug Error Editor #9062
platform.Registry.as(editor_1.Extensions.Editors).registerEditor(new baseEditor_1.EditorDescriptor(debugErrorEditor_1.DebugErrorEditor.ID, nls.localize({ comment: ['Debug is a noun in this context, not a verb.'], key: 'debugErrorEditor' }, "Debug Error"), 'vs/workbench/parts/debug/browser/debugErrorEditor', 'DebugErrorEditor'), [new descriptors_1.SyncDescriptor(debugEditorInputs_1.DebugErrorEditorInput)]);
// Register configuration
var configurationRegistry = platform.Registry.as(confregistry.Extensions.Configuration);
configurationRegistry.registerConfiguration({
    id: 'debug',
    order: 20,
    title: nls.localize('debugConfigurationTitle', "Debug"),
    type: 'object',
    properties: {
        'debug.allowBreakpointsEverywhere': {
            type: 'boolean',
            description: nls.localize({ comment: ['This is the description for a setting'], key: 'allowBreakpointsEverywhere' }, "Allows setting breakpoint in any file"),
            default: false
        },
        'debug.openExplorerOnEnd': {
            type: 'boolean',
            description: nls.localize({ comment: ['This is the description for a setting'], key: 'openExplorerOnEnd' }, "Automatically open explorer view on the end of a debug session"),
            default: false
        }
    }
});
