/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var nls = require("vs/nls");
var platform_1 = require("vs/platform/platform");
var actionbar_1 = require("vs/base/browser/ui/actionbar/actionbar");
var actionBarRegistry_1 = require("vs/workbench/browser/actionBarRegistry");
var baseEditor_1 = require("vs/workbench/browser/parts/editor/baseEditor");
var fileActions_1 = require("vs/workbench/parts/files/browser/fileActions");
var saveErrorHandler_1 = require("vs/workbench/parts/files/browser/saveErrorHandler");
var actions_1 = require("vs/platform/actions/common/actions");
var actionRegistry_1 = require("vs/workbench/common/actionRegistry");
var instantiation_1 = require("vs/platform/instantiation/common/instantiation");
var workspace_1 = require("vs/platform/workspace/common/workspace");
var keybinding_1 = require("vs/platform/keybinding/common/keybinding");
var explorerViewModel_1 = require("vs/workbench/parts/files/common/explorerViewModel");
var keyCodes_1 = require("vs/base/common/keyCodes");
var FilesViewerActionContributor = (function (_super) {
    __extends(FilesViewerActionContributor, _super);
    function FilesViewerActionContributor(instantiationService, contextService, keybindingService) {
        var _this = _super.call(this) || this;
        _this.instantiationService = instantiationService;
        _this.contextService = contextService;
        _this.keybindingService = keybindingService;
        return _this;
    }
    FilesViewerActionContributor.prototype.hasSecondaryActions = function (context) {
        var element = context.element;
        // Contribute only on Stat Objects (File Explorer)
        return element instanceof explorerViewModel_1.FileStat;
    };
    FilesViewerActionContributor.prototype.getSecondaryActions = function (context) {
        var stat = context.element;
        var tree = context.viewer;
        var actions = [];
        var separateOpen = false;
        // Open side by side
        if (!stat.isDirectory) {
            actions.push(this.instantiationService.createInstance(fileActions_1.OpenToSideAction, tree, stat.resource, false));
            separateOpen = true;
        }
        if (separateOpen) {
            actions.push(new actionbar_1.Separator(null, 50));
        }
        // Directory Actions
        if (stat.isDirectory) {
            // New File
            actions.push(this.instantiationService.createInstance(fileActions_1.NewFileAction, tree, stat));
            // New Folder
            actions.push(this.instantiationService.createInstance(fileActions_1.NewFolderAction, tree, stat));
            actions.push(new actionbar_1.Separator(null, 50));
        }
        else if (!stat.isDirectory) {
            // Run Compare
            var runCompareAction = this.instantiationService.createInstance(fileActions_1.CompareResourcesAction, stat.resource, tree);
            if (runCompareAction._isEnabled()) {
                actions.push(runCompareAction);
            }
            // Select for Compare
            actions.push(this.instantiationService.createInstance(fileActions_1.SelectResourceForCompareAction, stat.resource, tree));
            actions.push(new actionbar_1.Separator(null, 100));
        }
        var workspace = this.contextService.getWorkspace();
        var isRoot = workspace && stat.resource.toString() === workspace.resource.toString();
        // Copy File/Folder
        if (!isRoot) {
            actions.push(this.instantiationService.createInstance(fileActions_1.CopyFileAction, tree, stat));
        }
        // Paste File/Folder
        if (stat.isDirectory) {
            actions.push(this.instantiationService.createInstance(fileActions_1.PasteFileAction, tree, stat));
        }
        // Rename File/Folder
        if (!isRoot) {
            actions.push(new actionbar_1.Separator(null, 150));
            actions.push(this.instantiationService.createInstance(fileActions_1.TriggerRenameFileAction, tree, stat));
        }
        // Delete File/Folder
        if (!isRoot) {
            actions.push(this.instantiationService.createInstance(fileActions_1.MoveFileToTrashAction, tree, stat));
        }
        // Set Order
        var curOrder = 10;
        for (var i = 0; i < actions.length; i++) {
            var action = actions[i];
            if (!action.order) {
                curOrder += 10;
                action.order = curOrder;
            }
            else {
                curOrder = action.order;
            }
        }
        return actions;
    };
    FilesViewerActionContributor.prototype.getActionItem = function (context, action) {
        if (context && context.element instanceof explorerViewModel_1.FileStat) {
            // Any other item with keybinding
            var keybinding = fileActions_1.keybindingForAction(action.id, this.keybindingService);
            if (keybinding) {
                return new actionbar_1.ActionItem(context, action, { label: true, keybinding: this.keybindingService.getLabelFor(keybinding) });
            }
        }
        return null;
    };
    return FilesViewerActionContributor;
}(actionBarRegistry_1.ActionBarContributor));
FilesViewerActionContributor = __decorate([
    __param(0, instantiation_1.IInstantiationService),
    __param(1, workspace_1.IWorkspaceContextService),
    __param(2, keybinding_1.IKeybindingService)
], FilesViewerActionContributor);
var ConflictResolutionActionContributor = (function (_super) {
    __extends(ConflictResolutionActionContributor, _super);
    function ConflictResolutionActionContributor(instantiationService) {
        var _this = _super.call(this) || this;
        _this.instantiationService = instantiationService;
        return _this;
    }
    ConflictResolutionActionContributor.prototype.hasActionsForEditorInput = function (context) {
        return (context.input instanceof saveErrorHandler_1.ConflictResolutionDiffEditorInput);
    };
    ConflictResolutionActionContributor.prototype.getActionsForEditorInput = function (context) {
        return [
            this.instantiationService.createInstance(saveErrorHandler_1.AcceptLocalChangesAction),
            this.instantiationService.createInstance(saveErrorHandler_1.RevertLocalChangesAction)
        ];
    };
    return ConflictResolutionActionContributor;
}(baseEditor_1.EditorInputActionContributor));
ConflictResolutionActionContributor = __decorate([
    __param(0, instantiation_1.IInstantiationService)
], ConflictResolutionActionContributor);
// Contribute to Viewers that show Files
var actionBarRegistry = platform_1.Registry.as(actionBarRegistry_1.Extensions.Actionbar);
actionBarRegistry.registerActionBarContributor(actionBarRegistry_1.Scope.VIEWER, FilesViewerActionContributor);
// Contribute to Conflict Editor Inputs
actionBarRegistry.registerActionBarContributor(actionBarRegistry_1.Scope.EDITOR, ConflictResolutionActionContributor);
// Contribute Global Actions
var category = nls.localize('filesCategory', "Files");
var registry = platform_1.Registry.as(actionRegistry_1.Extensions.WorkbenchActions);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.SaveFileAction, fileActions_1.SaveFileAction.ID, fileActions_1.SaveFileAction.LABEL, { primary: 32768 /* CtrlCmd */ | 49 /* KEY_S */ }), 'Files: Save', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.SaveAllAction, fileActions_1.SaveAllAction.ID, fileActions_1.SaveAllAction.LABEL, { primary: 32768 /* CtrlCmd */ | 8192 /* Alt */ | 49 /* KEY_S */, win: { primary: keyCodes_1.KeyChord(32768 /* CtrlCmd */ | 41 /* KEY_K */, 49 /* KEY_S */) } }), 'Files: Save All', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.SaveFilesAction, fileActions_1.SaveFilesAction.ID, null /* only for programmatic trigger */), null);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.RevertFileAction, fileActions_1.RevertFileAction.ID, fileActions_1.RevertFileAction.LABEL), 'Files: Revert File', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.GlobalNewFileAction, fileActions_1.GlobalNewFileAction.ID, fileActions_1.GlobalNewFileAction.LABEL), 'Files: New File', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.GlobalNewFolderAction, fileActions_1.GlobalNewFolderAction.ID, fileActions_1.GlobalNewFolderAction.LABEL), 'Files: New Folder', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.GlobalCompareResourcesAction, fileActions_1.GlobalCompareResourcesAction.ID, fileActions_1.GlobalCompareResourcesAction.LABEL), 'Files: Compare Active File With...', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.FocusOpenEditorsView, fileActions_1.FocusOpenEditorsView.ID, fileActions_1.FocusOpenEditorsView.LABEL, { primary: keyCodes_1.KeyChord(32768 /* CtrlCmd */ | 41 /* KEY_K */, 35 /* KEY_E */) }), 'Files: Focus on Open Editors View', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.FocusFilesExplorer, fileActions_1.FocusFilesExplorer.ID, fileActions_1.FocusFilesExplorer.LABEL), 'Files: Focus on Files Explorer', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.ShowActiveFileInExplorer, fileActions_1.ShowActiveFileInExplorer.ID, fileActions_1.ShowActiveFileInExplorer.LABEL), 'Files: Show Active File in Explorer', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.CollapseExplorerView, fileActions_1.CollapseExplorerView.ID, fileActions_1.CollapseExplorerView.LABEL), 'Files: Collapse Folders in Explorer', category);
registry.registerWorkbenchAction(new actions_1.SyncActionDescriptor(fileActions_1.RefreshExplorerView, fileActions_1.RefreshExplorerView.ID, fileActions_1.RefreshExplorerView.LABEL), 'Files: Refresh Explorer', category);
