digraph campaignsSchema {
    label="Sourcegraph Campaigns Database Schema"
    rankdir=BT
    ratio=fill
    concentrate=true
    ranksep=1.4
    nodesep=0.4
    stylesheet="/assets/architecture.css"

    graph [
        fontname="Iosevka"
        fontsize=12
        pad=0.2
    ]

    node [
        colorscheme="set312"
        style="filled"
        fillcolor="white"
        shape="rectangle"
        fontname="Iosevka"
        fontsize=10
        margin=0.15
        target="_blank"
    ]

    edge [
        colorscheme="set312"
        penwidth=0.8
        arrowtail=invis
        arrowsize=1.35
    ]

    subgraph cluster_repositories {
        label="Repositories"
        rank="same"
        node [fillcolor="1"]

        repoA [ label="Repo A" ]
        repoB [ label="Repo B" ]
        repoC [ label="Repo C" ]
        repoD [ label="Repo D" ]
    }

    subgraph cluster_changesets {
      label="Changesets"
      rank="same"
      node [fillcolor="4"]
      edge [fillcolor="4"]

      changesetA [label="Changeset A", fillcolor="4"]
      changesetB [label="Changeset B", fillcolor="4"]
      changesetC [label="Changeset C", fillcolor="4"]
      /* changesetD [label="Changeset D", fillcolor="4"] */

      changesetA -> { repoA }
      changesetB -> { repoB }
      changesetC -> { repoC }
      /* changesetD -> { repoD } */
    }

    subgraph cluster_patchset1 {
        label="PatchSet 1 - First action exec"
        node [fillcolor="3"]

        patchset [label="PatchSet 1", fillcolor="7",shape="square"]
        patchA [label="Patch A", fillcolor="6",shape="egg"]
        patchB [label="Patch B", fillcolor="6",shape="egg"]
        patchC [label="Patch C", fillcolor="6",shape="egg"]
    }

    subgraph cluster_execution1 {
        label="Action instance 1"
        node [fillcolor="3"]

        execution [label="Action Execution 1", fillcolor="9",shape="square"]
        job1 [label="Action Job 1", fillcolor="8",shape="egg"]
        job2 [label="Action Job 2", fillcolor="8",shape="egg"]
        job3 [label="Action Job 3", fillcolor="8",shape="egg"]
    }

    subgraph changesetjobs {
      node [fillcolor="2"]
      changesetJobA [label="ChangesetJob A"]
      changesetJobB [label="ChangesetJob B"]
      changesetJobC [label="ChangesetJob C"]
    }

    campaign [label="Campaign", shape="circle", fillcolor="6"]

    execution -> { patchset } [fillcolor="9"]

    job1 -> { execution, repoA, patchA } [fillcolor="8"]
    job2 -> { execution, repoB, patchB } [fillcolor="8"]
    job3 -> { execution, repoC, patchC } [fillcolor="8"]

    patchA -> { patchset, repoA } [fillcolor="6"]
    patchB -> { patchset, repoB } [fillcolor="6"]
    patchC -> { patchset, repoC } [fillcolor="6"]

    campaign -> { changesetA, changesetB, changesetC } [ fillcolor="6" ]

    changesetJobA -> { campaign, patchA, changesetA } [ fillcolor="2" ]
    changesetJobB -> { campaign, patchB, changesetB } [ fillcolor="2" ]
    changesetJobC -> { campaign, patchC, changesetC } [ fillcolor="2" ]

    /* Before update */
    campaign -> { patchset } [ fillcolor="6" ]

    /* When updating a Campaign to have a new PatchSet: */

    /* subgraph cluster_patchset2 { */
    /*     label="PatchSet 2 - Second action exec" */
    /*     node [fillcolor="3"] */
    /*  */
    /*     patchset2 [label="PatchSet 2", fillcolor="7",shape="square"] */
    /*     patchD [label="Patch D", fillcolor="6",shape="egg"] */
    /* } */
    /*  */
    /*  */
    /* patchD -> { patchset2, repoD } [ fillcolor="6" ] */
    /*  */
    /* changesetJobD [label="ChangesetJob D", fillcolor="2"] */
    /* changesetJobD -> { campaign, patchD, changesetD } [ fillcolor="2" ] */
    /*  */
    /* campaign -> { patchset2 } [ fillcolor="6", penwidth="2" ] */
    /* campaign -> { changesetD } [ fillcolor="6" ] */
}
