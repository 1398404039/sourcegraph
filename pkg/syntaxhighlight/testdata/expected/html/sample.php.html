<span class="com">&lt;?php</span><span class="">
</span><span class="com">/**
 * Zend Framework (http://framework.zend.com/)
 *
 * @link      http://github.com/zendframework/zf2 for the canonical source repository
 * @copyright Copyright (c) 2005-2014 Zend Technologies USA Inc. (http://www.zend.com)
 * @license   http://framework.zend.com/license/new-bsd New BSD License
 */</span><span class="">

</span><span class="kwd">namespace</span><span class=""> </span><span class="pln">Zend\Cache\Storage\Adapter</span><span class="pun">;</span><span class="">

</span><span class="kwd">use</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">SplObjectStorage</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="kwd">stdClass</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Traversable</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Exception</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\Capabilities</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\Event</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\ExceptionEvent</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\Plugin</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\PostEvent</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\Cache\Storage\StorageInterface</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\EventManager\EventManager</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\EventManager\EventManagerInterface</span><span class="pun">;</span><span class="">
</span><span class="kwd">use</span><span class=""> </span><span class="pln">Zend\EventManager\EventsCapableInterface</span><span class="pun">;</span><span class="">

</span><span class="kwd">abstract</span><span class=""> </span><span class="kwd">class</span><span class=""> </span><span class="pln">AbstractAdapter</span><span class=""> </span><span class="kwd">implements</span><span class=""> </span><span class="pln">StorageInterface</span><span class="pun">,</span><span class=""> </span><span class="pln">EventsCapableInterface</span><span class="">
</span><span class="pun">{</span><span class="">
    </span><span class="com">/**
     * The used EventManager if any
     *
     * @var null|EventManagerInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$events</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">

    </span><span class="com">/**
     * Event handles of this adapter
     * @var array
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$eventHandles</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">

    </span><span class="com">/**
     * The plugin registry
     *
     * @var SplObjectStorage Registered plugins
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$pluginRegistry</span><span class="pun">;</span><span class="">

    </span><span class="com">/**
     * Capabilities of this adapter
     *
     * @var null|Capabilities
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$capabilities</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">

    </span><span class="com">/**
     * Marker to change capabilities
     *
     * @var null|object
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$capabilityMarker</span><span class="pun">;</span><span class="">

    </span><span class="com">/**
     * options
     *
     * @var mixed
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="pln">$options</span><span class="pun">;</span><span class="">

    </span><span class="com">/**
     * Constructor
     *
     * @param  null|array|Traversable|AdapterOptions $options
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">__construct</span><span class="pun">(</span><span class="pln">$options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$options</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">setOptions</span><span class="pun">(</span><span class="pln">$options</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Destructor
     *
     * detach all registered plugins to free
     * event handles of event manager
     *
     * @return void
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">__destruct</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getPluginRegistry</span><span class="pun">()</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$plugin</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">removePlugin</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">eventHandles</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$events</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">();</span><span class="">
            </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">eventHandles</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$handle</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$events</span><span class="pun">-&gt;</span><span class="atn">detach</span><span class="pun">(</span><span class="pln">$handle</span><span class="pun">);</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* configuration */</span><span class="">

    </span><span class="com">/**
     * Set options.
     *
     * @param  array|Traversable|AdapterOptions $options
     * @return AbstractAdapter
     * @see    getOptions()
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">setOptions</span><span class="pun">(</span><span class="pln">$options</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class=""> </span><span class="pun">!==</span><span class=""> </span><span class="pln">$options</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$options</span><span class=""> </span><span class="pln">instanceof</span><span class=""> </span><span class="pln">AdapterOptions</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">AdapterOptions</span><span class="pun">(</span><span class="pln">$options</span><span class="pun">);</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class="pun">-&gt;</span><span class="atn">setAdapter</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">);</span><span class="">
            </span><span class="pun">}</span><span class="">
            </span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">setAdapter</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">);</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$options</span><span class="pun">;</span><span class="">

            </span><span class="pln">$event</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Event</span><span class="pun">(</span><span class="str">&#39;option&#39;</span><span class="pun">,</span><span class=""> </span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">toArray</span><span class="pun">()));</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">trigger</span><span class="pun">(</span><span class="pln">$event</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Get options.
     *
     * @return AdapterOptions
     * @see setOptions()
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getOptions</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">setOptions</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">AdapterOptions</span><span class="pun">());</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">options</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Enable/Disable caching.
     *
     * Alias of setWritable and setReadable.
     *
     * @see    setWritable()
     * @see    setReadable()
     * @param  bool $flag
     * @return AbstractAdapter
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">setCaching</span><span class="pun">(</span><span class="pln">$flag</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$flag</span><span class="">    </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">bool</span><span class="pun">)</span><span class=""> </span><span class="pln">$flag</span><span class="pun">;</span><span class="">
        </span><span class="pln">$options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">();</span><span class="">
        </span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">setWritable</span><span class="pun">(</span><span class="pln">$flag</span><span class="pun">);</span><span class="">
        </span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">setReadable</span><span class="pun">(</span><span class="pln">$flag</span><span class="pun">);</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Get caching enabled.
     *
     * Alias of getWritable and getReadable.
     *
     * @see    getWritable()
     * @see    getReadable()
     * @return bool
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getCaching</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">();</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pun">(</span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">()</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">$options</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">());</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* Event/Plugin handling */</span><span class="">

    </span><span class="com">/**
     * Get the event manager
     *
     * @return EventManagerInterface
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getEventManager</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">events</span><span class=""> </span><span class="pun">===</span><span class=""> </span><span class="kwd">null</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">events</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">EventManager</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="pln">__CLASS__</span><span class="pun">,</span><span class=""> </span><span class="pln">get_class</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">)));</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">events</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Trigger a pre event and return the event response collection
     *
     * @param  string $eventName
     * @param  ArrayObject $args
     * @return \Zend\EventManager\ResponseCollection All handler return values
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">triggerPre</span><span class="pun">(</span><span class="pln">$eventName</span><span class="pun">,</span><span class=""> </span><span class="pln">ArrayObject</span><span class=""> </span><span class="pln">$args</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">trigger</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">Event</span><span class="pun">(</span><span class="pln">$eventName</span><span class=""> </span><span class="pun">.</span><span class=""> </span><span class="str">&#39;.pre&#39;</span><span class="pun">,</span><span class=""> </span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">));</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Triggers the PostEvent and return the result value.
     *
     * @param  string      $eventName
     * @param  ArrayObject $args
     * @param  mixed       $result
     * @return mixed
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">triggerPost</span><span class="pun">(</span><span class="pln">$eventName</span><span class="pun">,</span><span class=""> </span><span class="pln">ArrayObject</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$result</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$postEvent</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">PostEvent</span><span class="pun">(</span><span class="pln">$eventName</span><span class=""> </span><span class="pun">.</span><span class=""> </span><span class="str">&#39;.post&#39;</span><span class="pun">,</span><span class=""> </span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pln">$eventRs</span><span class="">   </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">trigger</span><span class="pun">(</span><span class="pln">$postEvent</span><span class="pun">);</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$postEvent</span><span class="pun">-&gt;</span><span class="atn">getResult</span><span class="pun">();</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Trigger an exception event
     *
     * If the ExceptionEvent has the flag &#34;throwException&#34; enabled throw the
     * exception after trigger else return the result.
     *
     * @param  string      $eventName
     * @param  ArrayObject $args
     * @param  mixed       $result
     * @param  \Exception  $exception
     * @throws Exception\ExceptionInterface
     * @return mixed
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">triggerException</span><span class="pun">(</span><span class="pln">$eventName</span><span class="pun">,</span><span class=""> </span><span class="pln">ArrayObject</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$exception</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$exceptionEvent</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ExceptionEvent</span><span class="pun">(</span><span class="pln">$eventName</span><span class=""> </span><span class="pun">.</span><span class=""> </span><span class="str">&#39;.exception&#39;</span><span class="pun">,</span><span class=""> </span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$exception</span><span class="pun">);</span><span class="">
        </span><span class="pln">$eventRs</span><span class="">        </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">trigger</span><span class="pun">(</span><span class="pln">$exceptionEvent</span><span class="pun">);</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$exceptionEvent</span><span class="pun">-&gt;</span><span class="atn">getThrowException</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">throw</span><span class=""> </span><span class="pln">$exceptionEvent</span><span class="pun">-&gt;</span><span class="atn">getException</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$exceptionEvent</span><span class="pun">-&gt;</span><span class="atn">getResult</span><span class="pun">();</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Check if a plugin is registered
     *
     * @param  Plugin\PluginInterface $plugin
     * @return bool
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">hasPlugin</span><span class="pun">(</span><span class="pln">Plugin\PluginInterface</span><span class=""> </span><span class="pln">$plugin</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$registry</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getPluginRegistry</span><span class="pun">();</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$registry</span><span class="pun">-&gt;</span><span class="atn">contains</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">);</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Register a plugin
     *
     * @param  Plugin\PluginInterface $plugin
     * @param  int                    $priority
     * @return AbstractAdapter Fluent interface
     * @throws Exception\LogicException
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">addPlugin</span><span class="pun">(</span><span class="pln">Plugin\PluginInterface</span><span class=""> </span><span class="pln">$plugin</span><span class="pun">,</span><span class=""> </span><span class="pln">$priority</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$registry</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getPluginRegistry</span><span class="pun">();</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$registry</span><span class="pun">-&gt;</span><span class="atn">contains</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">throw</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Exception\LogicException</span><span class="pun">(</span><span class="pln">sprintf</span><span class="pun">(</span><span class="">
                </span><span class="str">&#39;Plugin of type &#34;%s&#34; already registered&#39;</span><span class="pun">,</span><span class="">
                </span><span class="pln">get_class</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">)</span><span class="">
            </span><span class="pun">));</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$plugin</span><span class="pun">-&gt;</span><span class="atn">attach</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">(),</span><span class=""> </span><span class="pln">$priority</span><span class="pun">);</span><span class="">
        </span><span class="pln">$registry</span><span class="pun">-&gt;</span><span class="atn">attach</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">);</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Unregister an already registered plugin
     *
     * @param  Plugin\PluginInterface $plugin
     * @return AbstractAdapter Fluent interface
     * @throws Exception\LogicException
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">removePlugin</span><span class="pun">(</span><span class="pln">Plugin\PluginInterface</span><span class=""> </span><span class="pln">$plugin</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$registry</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getPluginRegistry</span><span class="pun">();</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$registry</span><span class="pun">-&gt;</span><span class="atn">contains</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$plugin</span><span class="pun">-&gt;</span><span class="atn">detach</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getEventManager</span><span class="pun">());</span><span class="">
            </span><span class="pln">$registry</span><span class="pun">-&gt;</span><span class="atn">detach</span><span class="pun">(</span><span class="pln">$plugin</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Return registry of plugins
     *
     * @return SplObjectStorage
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getPluginRegistry</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">pluginRegistry</span><span class=""> </span><span class="pln">instanceof</span><span class=""> </span><span class="pln">SplObjectStorage</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">pluginRegistry</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">SplObjectStorage</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">pluginRegistry</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* reading */</span><span class="">

    </span><span class="com">/**
     * Get an item.
     *
     * @param  string  $key
     * @param  bool $success
     * @param  mixed   $casToken
     * @return mixed Data on success, null on failure
     * @throws Exception\ExceptionInterface
     *
     * @triggers getItem.pre(PreEvent)
     * @triggers getItem.post(PostEvent)
     * @triggers getItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$casToken</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">

        </span><span class="pln">$argn</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">func_num_args</span><span class="pun">();</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
        </span><span class="pun">);</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$argn</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;success&#39;</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$success</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$argn</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="dec">2</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;casToken&#39;</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$casToken</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">);</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$args</span><span class="pun">-&gt;</span><span class="atn">offsetExists</span><span class="pun">(</span><span class="str">&#39;success&#39;</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">$args</span><span class="pun">-&gt;</span><span class="atn">offsetExists</span><span class="pun">(</span><span class="str">&#39;casToken&#39;</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;success&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;casToken&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="pun">}</span><span class=""> </span><span class="kwd">elseif</span><span class=""> </span><span class="pun">(</span><span class="pln">$args</span><span class="pun">-&gt;</span><span class="atn">offsetExists</span><span class="pun">(</span><span class="str">&#39;success&#39;</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;success&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="pun">}</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to get an item.
     *
     * @param  string  $normalizedKey
     * @param  bool $success
     * @param  mixed   $casToken
     * @return mixed Data on success, null on failure
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">abstract</span><span class=""> </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalGetItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$casToken</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">);</span><span class="">

    </span><span class="com">/**
     * Get multiple items.
     *
     * @param  array $keys
     * @return array Associative array of keys and values
     * @throws Exception\ExceptionInterface
     *
     * @triggers getItems.pre(PreEvent)
     * @triggers getItems.post(PostEvent)
     * @triggers getItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeys</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keys&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keys&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to get multiple items.
     *
     * @param  array $normalizedKeys
     * @return array Associative array of keys and values
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalGetItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pln">$result</span><span class="">  </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeys</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$value</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$success</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$success</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[</span><span class="pln">$normalizedKey</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Test if an item exists.
     *
     * @param  string $key
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers hasItem.pre(PreEvent)
     * @triggers hasItem.post(PostEvent)
     * @triggers hasItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">hasItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalHasItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to test if an item exists.
     *
     * @param  string $normalizedKey
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalHasItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$success</span><span class="pun">);</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$success</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Test multiple items.
     *
     * @param  array $keys
     * @return array Array of found keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers hasItems.pre(PreEvent)
     * @triggers hasItems.post(PostEvent)
     * @triggers hasItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">hasItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeys</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keys&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalHasItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keys&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to test multiple items.
     *
     * @param  array $normalizedKeys
     * @return array Array of found keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalHasItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeys</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalHasItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Get metadata of an item.
     *
     * @param  string $key
     * @return array|bool Metadata on success, false on failure
     * @throws Exception\ExceptionInterface
     *
     * @triggers getMetadata.pre(PreEvent)
     * @triggers getMetadata.post(PostEvent)
     * @triggers getMetadata.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getMetadata</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetMetadata</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to get metadata of an item.
     *
     * @param  string $normalizedKey
     * @return array|bool Metadata on success, false on failure
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalGetMetadata</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalHasItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Get multiple metadata
     *
     * @param  array $keys
     * @return array Associative array of keys and metadata
     * @throws Exception\ExceptionInterface
     *
     * @triggers getMetadatas.pre(PreEvent)
     * @triggers getMetadatas.post(PostEvent)
     * @triggers getMetadatas.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getMetadatas</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getReadable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeys</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keys&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetMetadatas</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keys&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to get multiple metadata
     *
     * @param  array $normalizedKeys
     * @return array Associative array of keys and metadata
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalGetMetadatas</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeys</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$metadata</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetMetadata</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$metadata</span><span class=""> </span><span class="pun">!==</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[</span><span class="pln">$normalizedKey</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$metadata</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* writing */</span><span class="">

    </span><span class="com">/**
     * Store an item.
     *
     * @param  string $key
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers setItem.pre(PreEvent)
     * @triggers setItem.post(PostEvent)
     * @triggers setItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">setItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to store an item.
     *
     * @param  string $normalizedKey
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">abstract</span><span class=""> </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalSetItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">

    </span><span class="com">/**
     * Store multiple items.
     *
     * @param  array $keyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers setItems.pre(PreEvent)
     * @triggers setItems.post(PostEvent)
     * @triggers setItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">setItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeyValuePairs</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keyValuePairs&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keyValuePairs&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to store multiple items.
     *
     * @param  array $normalizedKeyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalSetItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$failedKeys</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$failedKeys</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$failedKeys</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Add an item.
     *
     * @param  string $key
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers addItem.pre(PreEvent)
     * @triggers addItem.post(PostEvent)
     * @triggers addItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">addItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalAddItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to add an item.
     *
     * @param  string $normalizedKey
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalAddItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalHasItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Add multiple items.
     *
     * @param  array $keyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers addItems.pre(PreEvent)
     * @triggers addItems.post(PostEvent)
     * @triggers addItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">addItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeyValuePairs</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keyValuePairs&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalAddItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keyValuePairs&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to add multiple items.
     *
     * @param  array $normalizedKeyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalAddItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalAddItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Replace an existing item.
     *
     * @param  string $key
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers replaceItem.pre(PreEvent)
     * @triggers replaceItem.post(PostEvent)
     * @triggers replaceItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">replaceItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to replace an existing item.
     *
     * @param  string $normalizedKey
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalReplaceItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalhasItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Replace multiple existing items.
     *
     * @param  array $keyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers replaceItems.pre(PreEvent)
     * @triggers replaceItems.post(PostEvent)
     * @triggers replaceItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">replaceItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeyValuePairs</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keyValuePairs&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keyValuePairs&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">array_keys</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to replace multiple existing items.
     *
     * @param  array $normalizedKeyValuePairs
     * @return array Array of not stored keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalReplaceItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Set an item only if token matches
     *
     * It uses the token received from getItem() to check if the item has
     * changed before overwriting it.
     *
     * @param  mixed  $token
     * @param  string $key
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     * @see    getItem()
     * @see    setItem()
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">checkAndSetItem</span><span class="pun">(</span><span class="pln">$token</span><span class="pun">,</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;token&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$token</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalCheckAndSetItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;token&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to set an item only if token matches
     *
     * @param  mixed  $token
     * @param  string $normalizedKey
     * @param  mixed  $value
     * @return bool
     * @throws Exception\ExceptionInterface
     * @see    getItem()
     * @see    setItem()
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalCheckAndSetItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$token</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$oldValue</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">);</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$oldValue</span><span class=""> </span><span class="pun">!==</span><span class=""> </span><span class="pln">$token</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalSetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Reset lifetime of an item
     *
     * @param  string $key
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers touchItem.pre(PreEvent)
     * @triggers touchItem.post(PostEvent)
     * @triggers touchItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">touchItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalTouchItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to reset lifetime of an item
     *
     * @param  string $normalizedKey
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalTouchItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$success</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pln">$value</span><span class="">   </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$success</span><span class="pun">);</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$success</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Reset lifetime of multiple items.
     *
     * @param  array $keys
     * @return array Array of not updated keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers touchItems.pre(PreEvent)
     * @triggers touchItems.post(PostEvent)
     * @triggers touchItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">touchItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$keys</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeys</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keys&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalTouchItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keys&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to reset lifetime of multiple items.
     *
     * @param  array $normalizedKeys
     * @return array Array of not updated keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalTouchItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeys</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalTouchItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Remove an item.
     *
     * @param  string $key
     * @return bool
     * @throws Exception\ExceptionInterface
     *
     * @triggers removeItem.pre(PreEvent)
     * @triggers removeItem.post(PostEvent)
     * @triggers removeItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">removeItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalRemoveItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to remove an item.
     *
     * @param  string $normalizedKey
     * @return bool
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">abstract</span><span class=""> </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalRemoveItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">);</span><span class="">

    </span><span class="com">/**
     * Remove multiple items.
     *
     * @param  array $keys
     * @return array Array of not removed keys
     * @throws Exception\ExceptionInterface
     *
     * @triggers removeItems.pre(PreEvent)
     * @triggers removeItems.post(PostEvent)
     * @triggers removeItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">removeItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$keys</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeys</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keys&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalRemoveItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keys&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$keys</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to remove multiple items.
     *
     * @param  array $normalizedKeys
     * @return array Array of not removed keys
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalRemoveItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeys</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalRemoveItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Increment an item.
     *
     * @param  string $key
     * @param  int    $value
     * @return int|bool The new value on success, false on failure
     * @throws Exception\ExceptionInterface
     *
     * @triggers incrementItem.pre(PreEvent)
     * @triggers incrementItem.post(PostEvent)
     * @triggers incrementItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">incrementItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalIncrementItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to increment an item.
     *
     * @param  string $normalizedKey
     * @param  int    $value
     * @return int|bool The new value on success, false on failure
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalIncrementItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$success</span><span class="">  </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pln">$value</span><span class="">    </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">int</span><span class="pun">)</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">
        </span><span class="pln">$get</span><span class="">      </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">int</span><span class="pun">)</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$success</span><span class="pun">);</span><span class="">
        </span><span class="pln">$newValue</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$get</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$success</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalAddItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Increment multiple items.
     *
     * @param  array $keyValuePairs
     * @return array Associative array of keys and new values
     * @throws Exception\ExceptionInterface
     *
     * @triggers incrementItems.pre(PreEvent)
     * @triggers incrementItems.post(PostEvent)
     * @triggers incrementItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">incrementItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeyValuePairs</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keyValuePairs&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalIncrementItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keyValuePairs&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to increment multiple items.
     *
     * @param  array $normalizedKeyValuePairs
     * @return array Associative array of keys and new values
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalIncrementItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$newValue</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalIncrementItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$newValue</span><span class=""> </span><span class="pun">!==</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[</span><span class="pln">$normalizedKey</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Decrement an item.
     *
     * @param  string $key
     * @param  int    $value
     * @return int|bool The new value on success, false on failure
     * @throws Exception\ExceptionInterface
     *
     * @triggers decrementItem.pre(PreEvent)
     * @triggers decrementItem.post(PostEvent)
     * @triggers decrementItem.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">decrementItem</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;key&#39;</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">,</span><span class="">
            </span><span class="str">&#39;value&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalDecrementItem</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;key&#39;</span><span class="pun">],</span><span class=""> </span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;value&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to decrement an item.
     *
     * @param  string $normalizedKey
     * @param  int    $value
     * @return int|bool The new value on success, false on failure
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalDecrementItem</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$success</span><span class="">  </span><span class="pun">=</span><span class=""> </span><span class="kwd">null</span><span class="pun">;</span><span class="">
        </span><span class="pln">$value</span><span class="">    </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">int</span><span class="pun">)</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">
        </span><span class="pln">$get</span><span class="">      </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">int</span><span class="pun">)</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$success</span><span class="pun">);</span><span class="">
        </span><span class="pln">$newValue</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$get</span><span class=""> </span><span class="pun">-</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$success</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalReplaceItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalAddItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Decrement multiple items.
     *
     * @param  array $keyValuePairs
     * @return array Associative array of keys and new values
     * @throws Exception\ExceptionInterface
     *
     * @triggers incrementItems.pre(PreEvent)
     * @triggers incrementItems.post(PostEvent)
     * @triggers incrementItems.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">decrementItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getWritable</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKeyValuePairs</span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class="pun">);</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">(</span><span class="kwd">array</span><span class="pun">(</span><span class="">
            </span><span class="str">&#39;keyValuePairs&#39;</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">,</span><span class="">
        </span><span class="pun">));</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalDecrementItems</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">[</span><span class="str">&#39;keyValuePairs&#39;</span><span class="pun">]);</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to decrement multiple items.
     *
     * @param  array $normalizedKeyValuePairs
     * @return array Associative array of keys and new values
     * @throws Exception\ExceptionInterface
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalDecrementItems</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$normalizedKey</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$newValue</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">decrementItem</span><span class="pun">(</span><span class="pln">$normalizedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">$value</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$newValue</span><span class=""> </span><span class="pun">!==</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="pln">$result</span><span class="pun">[</span><span class="pln">$normalizedKey</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$newValue</span><span class="pun">;</span><span class="">
            </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$result</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* status */</span><span class="">

    </span><span class="com">/**
     * Get capabilities of this adapter
     *
     * @return Capabilities
     * @triggers getCapabilities.pre(PreEvent)
     * @triggers getCapabilities.post(PostEvent)
     * @triggers getCapabilities.exception(ExceptionEvent)
     */</span><span class="">
    </span><span class="kwd">public</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">getCapabilities</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">ArrayObject</span><span class="pun">();</span><span class="">

        </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$eventRs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPre</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">);</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">stopped</span><span class="pun">())</span><span class=""> </span><span class="pun">{</span><span class="">
                </span><span class="kwd">return</span><span class=""> </span><span class="pln">$eventRs</span><span class="pun">-&gt;</span><span class="atn">last</span><span class="pun">();</span><span class="">
            </span><span class="pun">}</span><span class="">

            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">internalGetCapabilities</span><span class="pun">();</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerPost</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">(</span><span class="pln">\Exception</span><span class=""> </span><span class="pln">$e</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">;</span><span class="">
            </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">triggerException</span><span class="pun">(</span><span class="pln">__FUNCTION__</span><span class="pun">,</span><span class=""> </span><span class="pln">$args</span><span class="pun">,</span><span class=""> </span><span class="pln">$result</span><span class="pun">,</span><span class=""> </span><span class="pln">$e</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Internal method to get capabilities of this adapter
     *
     * @return Capabilities
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">internalGetCapabilities</span><span class="pun">()</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">capabilities</span><span class=""> </span><span class="pun">===</span><span class=""> </span><span class="kwd">null</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">capabilityMarker</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="kwd">stdClass</span><span class="pun">();</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">capabilities</span><span class="">     </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Capabilities</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">capabilityMarker</span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">return</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">capabilities</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/* internal */</span><span class="">

    </span><span class="com">/**
     * Validates and normalizes a key
     *
     * @param  string $key
     * @return void
     * @throws Exception\InvalidArgumentException On an invalid key
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">normalizeKey</span><span class="pun">(</span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$key</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$key</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">string</span><span class="pun">)</span><span class=""> </span><span class="pln">$key</span><span class="pun">;</span><span class="">

        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">$key</span><span class=""> </span><span class="pun">===</span><span class=""> </span><span class="str">&#39;&#39;</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">throw</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Exception\InvalidArgumentException</span><span class="pun">(</span><span class="">
                </span><span class="str">&#34;An empty key isn&#39;t allowed&#34;</span><span class="">
            </span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class=""> </span><span class="kwd">elseif</span><span class=""> </span><span class="pun">((</span><span class="pln">$p</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">getOptions</span><span class="pun">()</span><span class="pun">-&gt;</span><span class="atn">getKeyPattern</span><span class="pun">())</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pun">!</span><span class="pln">preg_match</span><span class="pun">(</span><span class="pln">$p</span><span class="pun">,</span><span class=""> </span><span class="pln">$key</span><span class="pun">))</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">throw</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Exception\InvalidArgumentException</span><span class="pun">(</span><span class="">
                </span><span class="str">&#34;The key &#39;{$key}&#39; doesn&#39;t match against pattern &#39;{$p}&#39;&#34;</span><span class="">
            </span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Validates and normalizes multiple keys
     *
     * @param  array $keys
     * @return void
     * @throws Exception\InvalidArgumentException On an invalid key
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">normalizeKeys</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keys</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">$keys</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">throw</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Exception\InvalidArgumentException</span><span class="pun">(</span><span class="">
                </span><span class="str">&#34;An empty list of keys isn&#39;t allowed&#34;</span><span class="">
            </span><span class="pun">);</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">array_walk</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">,</span><span class=""> </span><span class="kwd">array</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class=""> </span><span class="str">&#39;normalizeKey&#39;</span><span class="pun">));</span><span class="">
        </span><span class="pln">$keys</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">array_values</span><span class="pun">(</span><span class="pln">array_unique</span><span class="pun">(</span><span class="pln">$keys</span><span class="pun">));</span><span class="">
    </span><span class="pun">}</span><span class="">

    </span><span class="com">/**
     * Validates and normalizes an array of key-value pairs
     *
     * @param  array $keyValuePairs
     * @return void
     * @throws Exception\InvalidArgumentException On an invalid key
     */</span><span class="">
    </span><span class="kwd">protected</span><span class=""> </span><span class="kwd">function</span><span class=""> </span><span class="pln">normalizeKeyValuePairs</span><span class="pun">(</span><span class="kwd">array</span><span class=""> </span><span class="pun">&amp;</span><span class=""> </span><span class="pln">$keyValuePairs</span><span class="pun">)</span><span class="">
    </span><span class="pun">{</span><span class="">
        </span><span class="pln">$normalizedKeyValuePairs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">array</span><span class="pun">();</span><span class="">
        </span><span class="kwd">foreach</span><span class=""> </span><span class="pun">(</span><span class="pln">$keyValuePairs</span><span class=""> </span><span class="kwd">as</span><span class=""> </span><span class="pln">$key</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">$value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="atn">normalizeKey</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">);</span><span class="">
            </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">[</span><span class="pln">$key</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$value</span><span class="pun">;</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="pln">$keyValuePairs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">$normalizedKeyValuePairs</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">
</span><span class="pun">}</span><span class="">

</span><span class="str">&lt;&lt;&lt;HEREDOC
	do cats
eat bats
HEREDOC;</span><span class="">

</span><span class="str">&lt;&lt;&lt;&#39;NOWDOC&#39;
	do cats
eat bats
NOWDOC;</span><span class="">

</span><span class="str">&lt;&lt;&lt;&#34;HEREDOCQ&#34;
	do cats
eat bats
HEREDOCQ;</span>

