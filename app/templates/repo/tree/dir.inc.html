{{define "RepoTreeDir"}}
{{if .Entry}}

<div class="panel panel-repo-tree">

	{{$repo:=.Repo}}
	{{$repoRevSpec:=.EntrySpec.RepoRev}}
	{{$parentEntryPath:=.EntryPath}}

	<div data-react="TreeSearch"
			data-repo="{{$repo.URI}}"
			data-rev="{{$repoRevSpec.Rev}}"
			{{if isRepoTreePage .CurrentURL}}
			data-overlay="true"
			{{end}}
			data-commit="{{$repoRevSpec.CommitID}}"></div>

	{{if isRepoTreePage .CurrentURL}}
	<header class="commit">
		{{with .RepoCommit}}{{template "TreeTopCommit" .}}{{end}}
	</header>
	<table class="table repo-tree-dir">
	{{if not (eq .EntryPath ".")}}
		<tr class="entry entry-parent-nav">
			<td class="icon"></td>
			<td class="name">
				{{$pathParts := pathSplit $parentEntryPath}}
				{{range $index, $part := $pathParts}}
					<a {{if eq 0 $index}}class="first-part"{{end}} href="{{urlToRepoTreeEntry $repo.URI $repoRevSpec.Rev (subpath $pathParts $index)}}">{{$part}}</a>
					<span> / </span>
				{{end}}
			</td>
		</tr>
	{{end}}
	{{range .Entry.Entries}}
		{{$fullPath := (pathJoin $parentEntryPath (flattenName .))}}
		{{$isDir := eq .Type.String "DirEntry"}}
		<tr class="entry">
			<td class="icon"><i class="{{if eq .Type.String "FileEntry"}}fa fa-file-text-o{{else if eq .Type.String "DirEntry"}}fa fa-folder{{else if eq .Type.String "SubmoduleEntry"}}fa fa-share-square{{else}}fa fa-file-o{{end}}"></i></td>
			<td class="name">
				{{if ne .Type.String "SubmoduleEntry"}}
					<a href="{{urlToRepoTreeEntry $repo.URI $repoRevSpec.Rev $fullPath}}">{{flattenNameHTML .}}</a>
				{{else}}
					<span class="disabled">{{flattenNameHTML .}}</span>
				{{end}}
			</td>
			{{if or appconf.DisableTreeEntryCommits (not $.Features.TreeEntryCommits)}}
				<td></td>
			{{else}}
				<td class="commit">
					<div data-react="TreeEntryCommit" data-repo="{{$repo.URI}}" data-rev="{{$repoRevSpec.CommitID}}" data-path="{{$fullPath}}"></div>
				</td>
			{{end}}
		</tr>
	{{end}}
	</table>
	{{end}}
</div>
{{end}}
{{end}}
