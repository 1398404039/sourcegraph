{{define "Head"}}<title>Sourcegraph</title>
{{end}}

{{define "Body"}}

<script ignore-csp>
	{{if .Repos}}
		window.repos = JSON.parse({{json .Repos.Repos}}) || [];
	{{end}}
	{{if .RemoteRepos}}
		window.remoteRepos = JSON.parse({{json .RemoteRepos.RemoteRepos}});
	{{end}}
	window.teammates = JSON.parse({{json .Teammates}});

	window.onboarding = {
		linkGitHub: false, // user needs to link GitHub account
		linkGitHubURL: null, // URL for GitHub OAuth
		linkGitHubRedirect: false, // user is beind redirected to the dashboard from GitHub
	};
	{{if .LinkGitHub}}
		window.onboarding.linkGitHub = true;
		window.onboarding.linkGitHubURL = "{{router.URLToGitHubOAuth}}";
	{{else if .GitHubOnboarding}}
		window.onboarding.linkGitHubRedirect = true;
	{{end}}

	{{if (and .Teammates .Teammates.Organizations) }}
	window.intercomSettings.companies = JSON.parse({{json .Teammates.Organizations}}).map(function(company) {
		return {
			id: "github_" + company,
			name: company,
		}
	});
	{{end}}

	{{if .RemoteRepos}}
	var langMap = {};
	window.remoteRepos.forEach(function(repo) {
		if (!repo.Language) return;
		var lang = repo.Language.replace(/\s/g, "_");
		if (lang === "undefined") return;
		if (langMap[lang]) langMap[lang] += 1;
		if (!langMap[lang]) langMap[lang] = 1;
	});
	Object.keys(langMap).forEach(function(lang) {
		window.intercomSettings["repos_" + lang] = langMap[lang];
	});
	{{end}}
</script>

<div class="dashboard">
	<div id="DashboardContainer"></div>
</div>

{{end}}
